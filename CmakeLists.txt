cmake_minimum_required(VERSION 3.16)
project(BinaryTree LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Поиск Google Test
find_package(GTest REQUIRED)

# ОБЩИЕ настройки компиляции
set(COMMON_COMPILE_OPTIONS
    $<$<CXX_COMPILER_ID:GNU,Clang,AppleClang>:-Wall>
    $<$<CXX_COMPILER_ID:GNU,Clang,AppleClang>:-Wextra>
    $<$<CXX_COMPILER_ID:MSVC>:/W4>
)

# Основное приложение (ВСЕГДА user mode)
add_executable(binary_tree
    source/main.cpp
)

# Подключаем заголовки
target_include_directories(binary_tree PRIVATE include)

# Применяем общие настройки компиляции
target_compile_options(binary_tree PRIVATE ${COMMON_COMPILE_OPTIONS})

# ОТДЕЛЬНЫЙ исполняемый файл для тестов
add_executable(binary_tree_tests
    tests/test_main.cpp
    tests/test_avl_tree.cpp
  # добавляем реализацию дерева для тестов
)

# Подключаем заголовки для тестов
target_include_directories(binary_tree_tests PRIVATE include)

# Линкуем Google Test к тестам
target_link_libraries(binary_tree_tests PRIVATE GTest::gtest GTest::gtest_main)

# Применяем общие настройки компиляции к тестам
target_compile_options(binary_tree_tests PRIVATE ${COMMON_COMPILE_OPTIONS})

# Автоматическое обнаружение тестов
include(GoogleTest)
gtest_discover_tests(binary_tree_tests)

message(STATUS "BinaryTree: Built main app 'binary_tree' and tests 'binary_tree_tests'")
